<form class="popup-inner-content step1" onsubmit="return validateOfflineForm();">
  <div class="popup-top">
    <div class="step1-card">
      <div class="popup-title">Get this phone delivered in 4 hours!</div>
      <table class="checkout">
        <tr class="heading">
          <th class="item" colspan="2">Item</th>
          <th class="colours">Colours</th>
          <th class="qty">Qty</th>
          <th class="price">Special Price</th>
        </tr>
        <tr>
          <td class="product-image">
            <img/>
          </td>
          <td class="product-name">
            <div></div>
          </td>
          <td class="product-colours">All Colours</td>
          <td class="product-qty">
            <div>1</div>
          </td>
          <td class="product-price">
            <span class="instore-price">&#x20B9;<span></span></span>
            <span class="offer-price">&#x20B9;<span></span></span>
            <div class="price-info">Inclusive of all taxes<br/>&amp; shipping charges.</div>
          </td>
        </tr>
      </table>
      <div class="store-info">
        <div class="popup-box">
          <div class="trusted-seller">
            <img src="http://b12984e4d8c82ca48867-a8f8a87b64e178f478099f5d1e26a20d.r85.cf1.rackcdn.com/trusted_seller.png" alt="Trusted Seller"/>
          </div>
          <div class="product-seller">Sold by<br/><img/><br/><div class="slogan">&nbsp;</div></div>
        </div>
        <div><strong>Fastest Expert Delivery</strong> &ndash; Shopping experience at your door step!</div>
        <ul>
          <li>Buyback old phone</li>
          <li>Data transfer</li>
          <li>SIM cutting facility</li>
          <li>SIM changer facility</li>
          <li>Accessories</li>
          <li>Protection plans</li>
        </ul>
      </div>
      <div class="step1-form">
        <div class="headline">Check availability for your location</div>
        <div class="popup-form">
          <div class="popup-field">
            <label class="mobile-prefix" for="popup-mobile">+91</label>
            <input type="text" id="popup-mobile" maxlength="10" placeholder="Your Mobile Number" title="Your Mobile Number"/>
          </div>
          <div class="popup-field">
            <input type="text" id="popup-pincode" maxlength="6" placeholder="Your Pin Code" title="Your Pin Code"/>
          </div>
          <div id="fail-message">We are very sorry, but this item is currently not available near your location.</div>
        </div>
      </div>
    </div>
    <div class="step2-card">
      <div class="popup-left">
        <div class="headline">Store details</div>
        <div class="popup-box">
          <div class="store-logo">
            <img/>
          </div>
          <div class="trusted-seller">
            <img src="http://b12984e4d8c82ca48867-a8f8a87b64e178f478099f5d1e26a20d.r85.cf1.rackcdn.com/trusted_seller.png" alt="Trusted Seller"/>
          </div>
          <br style="clear: both;"/>
          <div class="store-delivery">Will be delivered by <span></span> nearest to you.</div>
          <div class="store-details">
            <div class="store-name"></div>
            <div class="store-address"></div>
          </div>
        </div>
        <div class="store-concern">Any concerns? Call the store:</div>
        <span class="mobile-prefix">+91</span>
        <div class="store-phone">&nbsp;</div>
      </div>
      <div class="popup-right">
        <div class="headline">Choose a shipping option</div>
        <div class="step2-form">
          <div class="popup-form">
            <div class="popup-field">
              <input type="radio" id="popup-pickup" class="shipping-option" name="shipping-option" value="pickup" disabled/>
              <label for="popup-pickup">Pickup from store</label>
            </div>
            <div class="popup-field">
              <input type="radio" id="popup-delivery" class="shipping-option" name="shipping-option" value="delivery" disabled/>
              <label for="popup-delivery">Deliver to your address</label>
            </div>
            <div class="popup-field">
              <input type="text" id="popup-name" maxlength="100" placeholder="Your Name" title="Your Name"/>
            </div>
            <div class="popup-field">
              <input type="text" id="popup-email" placeholder="Your Email" title="Your Email"/>
            </div>
            <div id="pickup-note">Pick up the item from the store address on the left.</div>
            <div class="popup-field">
              <textarea id="popup-address" maxlength="300" placeholder="Your Address" title="Your Address"></textarea>
            </div>
            <div class="popup-field">
              <input type="text" id="popup-pincode2" value="Pin code: " disabled/>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="popup-bottom">
    <div class="popup-tnc">Payment by cash-on-delivery, credit card or debit card only. After confirmation, the item<br/>will be delivered within 4 hours. Orders placed after 7 PM will be delivered the next day.</div>
    <input type="submit" id="popup-submit" class="btn btn-red btn-xl" value="Place Order"/>
  </div>
  <div class="step-done-card">
    <div class="headline">Order Successful!</div>
    <div class="done-card">
      <img class="done-image" src="http://b12984e4d8c82ca48867-a8f8a87b64e178f478099f5d1e26a20d.r85.cf1.rackcdn.com/check_icon.png" alt="Great!"/>
      <div class="done-heading">Done</div>
      <div class="done-message"><img/> representative will call you shortly.</div>
    </div>
  </div>
</form>
<style type="text/css">
  .step1 .step2-card,
  .step1 .step-done-card,
  .step2 .step1-card,
  .step2 .step-done-card,
  .step-done .step1-card,
  .step-done .step2-card {
    display: none;
  }
  .popup-inner-content {
    position: relative;
    display: block;
    width: 840px;
    background-color: #fff;
  }
  .popup-top {
    padding: 20px;
  }
  .step1-card,
  .step2-card,
  .popup-field {
    display: inline-block;
  }
  .popup-title {
    font-size: 24px;
    line-height: 28px;
    font-weight: bold;
    text-align: center;
    color: #c00;
  }
  .checkout {
    margin-top: 12px;
    font-size: 14px;
    text-align: center;
  }
  .checkout th,
  .checkout td {
    padding: 10px;
  }
  .checkout th + th,
  .checkout td + td {
    border-left: 1px solid #eee;
  }
  .checkout td {
    vertical-align: middle !important;
  }
  .checkout .heading {
    border-bottom: 1px solid #ccc;
    text-transform: uppercase;
  }
  .checkout .heading .price {
    color: #c00;
  }
  .checkout .product-image {
    width: 80px;
  }
  .checkout .product-image img {
    max-width: 80px;
    max-height: 60px;
  }
  .checkout .product-name {
    width: 320px;
    border-left: none;
    text-align: left;
  }
  .checkout .product-name div {
    font-size: 16px;
    line-height: 20px;
    max-height: 60px;
    overflow: hidden;
  }
  .checkout .product-colours,
  .checkout .product-qty {
    width: 100px;
  }
  .checkout .product-colours,
  .store-info,
  #fail-message {
    font-size: 13px;
    line-height: 18px;
  }
  .checkout .product-qty div {
    width: 30px;
    line-height: 30px;
    border: 1px solid #ddd;
    margin: 0 auto;
    background-color: #eee;
  }
  .checkout .product-price {
    width: 200px;
  }
  .checkout .instore-price {
    text-decoration: line-through;
    color: #666;
  }
  .checkout .offer-price {
    margin-left: 6px;
    font-size: 18px;
    font-weight: bold;
    color: #c00;
  }
  .checkout .price-info,
  .product-seller .slogan {
    font-style: italic;
    color: #666;
  }
  .checkout .price-info {
    margin-top: 12px;
    font-size: 12px;
    line-height: 14px;
  }
  .store-info,
  .step1-form {
    float: left;
    margin-top: 12px;
  }
  .store-info {
    width: 485px;
    margin-right: 12px;
  }
  .popup-box {
    padding: 10px;
    border: 2px solid #ddd;
  }
  .store-info .popup-box {
    margin-bottom: 12px;
    font-size: 14px;
    line-height: 20px;
  }
  .product-seller img,
  .done-message img {
    height: 33px;
  }
  .product-seller img {
    max-width: 180px;
  }
  .product-seller .slogan,
  .store-name,
  .store-phone {
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
  }
  .store-info ul {
    font-size: 12px;
    color: #555;
  }
  .store-info li {
    float: left;
    width: 50%;
  }
  .step1-form {
    width: 277px;
    padding: 18px 12px;
    border: 1px solid #ddd;
    background-color: #f7f7f7;
    text-align: center;
  }
  .headline {
    font-size: 18px;
    color: #333;
  }
  .popup-form {
    position: relative;
  }
  .step1-form .popup-field,
  #fail-message {
    margin-top: 18px;
  }
  .mobile-prefix {
    float: left;
    padding: 10px 6px;
    border: 1px solid #ccc;
    border-right: none;
    font-size: 14px;
    line-height: 16px;
    background-color: #f7f7f7;
    color: #777;
  }
  .popup-form input[type="text"],
  .popup-form textarea {
    padding: 6px;
    border: 1px solid #ccc;
    outline: none;
    margin: 0;
    font-size: 14px;
    line-height: 20px;
    color: #666;
  }
  .popup-form input[type="text"] {
    width: 225px;
    height: 24px;
  }
  .popup-form input[type="text"]:focus {
    border-color: #999;
  }
  #popup-mobile {
    width: 188px;
  }
  #fail-message {
    display: none;
    color: #c00;
  }
  .popup-left,
  .popup-right {
    float: left;
    width: 385px;
    font-size: 14px;
    line-height: 20px;
  }
  .popup-left {
    margin-right: 30px;
  }
  .step2-card .headline {
    margin-bottom: 12px;
  }
  .store-logo {
    float: left;
    margin: 0 12px 12px 0;
  }
  .store-logo img {
    max-width: 238px;
    max-height: 90px;
  }
  .trusted-seller,
  #popup-submit {
    float: right;
  }
  .trusted-seller img {
    width: 110px;
    height: 30px;
  }
  .store-delivery span,
  .store-name {
    font-weight: bold;
  }
  .store-address {
    max-height: 100px;
    overflow: hidden;
  }
  .store-concern {
    margin: 18px 0 6px;
  }
  .store-phone,
  #popup-pincode2,
  .popup-bottom {
    background-color: #f3f3f3;
  }
  .store-phone {
    display: inline-block;
    width: 175px;
    padding: 8px;
    border: 1px solid #ccc;
  }
  .shipping-option {
    position: relative;
    top: 2px;
    margin-right: 2px;
  }
  .shipping-option[disabled] + label {
    color: #999;
  }
  #popup-delivery {
    margin-left: 12px;
  }
  .step2-card .popup-form input[type="text"],
  .step2-card .popup-form textarea {
    display: none;
    width: 371px;
    margin-top: 12px;
  }
  .popup-form textarea {
    height: 120px;
    resize: none;
  }
  #pickup-note {
    display: none;
    margin-top: 12px;
    font-size: 13px;
  }
  .popup-bottom {
    padding: 10px 20px;
    border-top: 1px dotted #ccc;
    overflow: hidden;
    clear: both;
  }
  .popup-tnc {
    float: left;
    max-width: 600px;
    font-size: 12px;
    line-height: 18px;
    color: #555;
  }
  .step-done-card {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    background-color: #fff;
    text-align: center;
  }
  .step-done-card .headline {
    margin: 20px 20px 0;
  }
  .done-card {
    margin: 20px;
    color: #555;
  }
  .done-image {
    width: 78px;
    height: 78px;
  }
  .done-heading {
    margin-top: 20px;
    font-size: 26px;
  }
  .done-message {
    margin-top: 30px;
    font-size: 16px;
    line-height: 33px;
  }
  .done-message img {
    max-width: 535px;
    vertical-align: bottom;
  }
</style>
<script type="text/javascript">
  var isbn, skuId, instorePrice, offerPrice, mobileValue, pincodeValue, storeId, insertId, orderId, storeCode;
  setCookieMins("3hrspopup", "1", 15);
  setCookieMins("autoPopup", "1", 15);

  function validateOfflineForm() {
    var $form = $(".popup-inner-content");

    if ($form.hasClass("step1")) {
      $("#fail-message").hide();
      
      var mobileRegex = /^\d{10}$/;
      mobileValue = $.trim($("#popup-mobile").val());
      if (!mobileRegex.test(mobileValue)) {
        alert("Please enter a valid 10-digit mobile number.");
        $("#popup-mobile").focus();
        return false;
      }

      var pincodeRegex = /^\d{6}$/;
      pincodeValue = $.trim($("#popup-pincode").val());
      if (!pincodeRegex.test(pincodeValue)) {
        alert("Please enter a valid pin code.");
        $("#popup-pincode").focus();
        return false;
      }
      $("#popup-pincode2").val($("#popup-pincode2").val() + pincodeValue);

      var $pageTitle = $("#mspSingleTitle");
      isbn = $pageTitle.data("mspid");
      skuId = $pageTitle.data("offlinesku");
      instorePrice = $pageTitle.data("offlineinstoreprice");
      offerPrice = $pageTitle.data("offlineofferprice");

      $("#popup-submit").addClass("btn-disabled");
      $.ajax({
        url: "/offline/sameday_delivery.php",
        data: {
          mspid: isbn,
          sku: skuId,
          instoreprice: instorePrice,
          offerprice: offerPrice,
          mobile: mobileValue,
          pincode: pincodeValue,
          firststep: true,
          referrer: tmsTrigger
        }
      }).done(function (response) {
        if (response) {
          var json = $.parseJSON(response);
          if (json.stores && json.stores.length) {
            var store = json.stores[0];
            if (store.id) {
              storeId = store.id;
              if (store.logo)
                $(".store-logo img, .done-message img").attr("src", store.logo);
              if (store.name) {
                $(".store-delivery span, .store-name").text(store.name);
                $(".store-logo img, .done-message img").attr("alt", store.name);
              }
              if (store.address)
                $(".store-address").text(store.address);
              if (store.storephone)
                $(".store-phone").text(store.storephone);
              if (store.shipping) {
                if (store.shipping.pickup)
                  $("#popup-pickup").prop("disabled", false).click();
                if (store.shipping.delivery)
                  $("#popup-delivery").prop("disabled", false).click();
                if (store.shipping.pickup || store.shipping.delivery)
                  $("#popup-name, #popup-email").show();
              }
              insertId = store.insertid;
              orderId = store.orderid;
              storeCode = store.storecode;
              $form.toggleClass("step1 step2");
              $("#popup-submit").val("Confirm Order");
              $("#popup-pickup").focus();
            }
            else
              $("#fail-message").show();
          }
          else
            $("#fail-message").show();
        }
        else
          $("#fail-message").show();
      }).fail(function () {
        $("#fail-message").show();
      }).always(function () {
        $("#popup-submit").removeClass("btn-disabled");
      });
    }
    else if ($form.hasClass("step2")) {
      if (!$("#popup-pickup").is(":checked") && !$("#popup-delivery").is(":checked")) {
        alert("Please select a shipping option.");
        $("#popup-pickup").focus();
        return false;
      }
      var shippingValue = $.trim($(".shipping-option:checked").val());

      var nameValue = $.trim($("#popup-name").val());
      if (!nameValue.length) {
        alert("Please enter your name.");
        $("#popup-name").focus();
        return false;
      }

      var emailRegex = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,
          emailValue = $.trim($("#popup-email").val());
      if (!emailRegex.test(emailValue)) {
        alert("Please enter a valid email.");
        $("#popup-email").focus();
        return false;
      }

      var request = {
        "mspid": isbn,
        "sku": skuId,
        "instoreprice": instorePrice,
        "offerprice": offerPrice,
        "email": emailValue,
        "mobile": mobileValue,
        "pincode": pincodeValue,
        "firststep": false,
        "storeid": storeId,
        "insertid": insertId,
        "orderid": orderId,
        "storecode": storeCode,
        "shipping": shippingValue,
        "name": nameValue,
        "referrer": tmsTrigger
      };

      if ($("#popup-delivery").is(":checked")) {
        var addressValue = $.trim($("#popup-address").val());
        if (!addressValue.length) {
          alert("Please enter your address.");
          $("#popup-address").focus();
          return false;
        }
        request.address = addressValue;
      }

      $.ajax({
        url: "/offline/sameday_delivery.php",
        data: request
      });

      $form.toggleClass("step2 step-done");
      setTimeout("closePopup();", 8000);
    }
    return false;
  }

  $(document).ready(function () {
    setTimeout("$('#popup-mobile').focus();", 600);

    var $pageTitle = $("#mspSingleTitle");
    $(".product-image img").attr({
      "src": $("#mspSingleImg").attr("src"),
      "alt": $pageTitle.text()
    });
    $(".product-name div").text($pageTitle.text());
    $(".instore-price span").text($pageTitle.data("offlineinstoreprice"));
    $(".offer-price span").text($pageTitle.data("offlineofferprice"));
    $(".product-seller img").attr({
      "src": $pageTitle.data("offlinestorelogo"),
      "alt": $pageTitle.data("offlinestorename")
    });
    $(".product-seller .slogan").text($pageTitle.data("offlinestoretagline"));

    $("body").on("change", ".shipping-option", function () {
      if ($("#popup-pickup").is(":checked")) {
        $(".store-delivery, #popup-address, #popup-pincode2").hide();
        $(".store-details, #pickup-note").show();
      }
      else if ($("#popup-delivery").is(":checked")) {
        $(".store-details, #pickup-note").hide();
        $(".store-delivery, #popup-address, #popup-pincode2").show();
      }
      setTimeout("$('#popup-name').focus();", 200);
    });
  });
</script>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-7587491-10']);
  _gaq.push(['_setDomainName', 'mysmartprice.com']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview', '/promotions/sameday_delivery.html?mspid=' + $("#mspSingleTitle").data("mspid")]);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>